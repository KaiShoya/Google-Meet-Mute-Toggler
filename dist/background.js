const T="https://meet.google.com/",l="https://meet.google.com/*",g="https://teams.microsoft.com/_",f="https://teams.microsoft.com/_*",M="https://teams.microsoft.com/v2/",b="https://teams.microsoft.com/v2/*",i=chrome.runtime.getURL("icons/M_gray128.png"),_=chrome.runtime.getURL("icons/M_red128.png"),I=chrome.runtime.getURL("icons/M_green128.png"),y=t=>{const e=t[0].result[0],s=t[0].result[1]?e?_:I:i;chrome.action.setIcon({path:s})},c={tabId:-1,onlyTab:!1,isOpen:!1,alerts:!1,count:0},O=()=>{chrome.tabs.query({url:l},t=>{const e=m(t,T,"Google Meets");c.isOpen=e.isOpen,c.tabId=e.tabId,c.count=e.count,c.alerts=e.alerts,c.onlyTab=e.onlyTab})},n={tabId:-1,onlyTab:!1,isOpen:!1,alerts:!1,count:0},a={tabId:-1,onlyTab:!1,isOpen:!1,alerts:!1,count:0},E=()=>{chrome.tabs.query({url:f},t=>{const e=m(t,g,"Microsoft Teams");n.isOpen=e.isOpen,n.tabId=e.tabId,n.count=e.count,n.alerts=e.alerts,n.onlyTab=e.onlyTab}),chrome.tabs.query({url:b},t=>{const e=m(t,M,"Microsoft Teams");a.isOpen=e.isOpen,a.tabId=e.tabId,a.count=e.count,a.alerts=e.alerts,a.onlyTab=e.onlyTab})},h=(t,e,o)=>{chrome.tabs.query({url:e},s=>{t!=-1&&chrome.scripting.executeScript({target:{tabId:Number(s[t].id)},files:[o]})})},L=t=>h(t,l,"dist/sendKeypressMeet.js"),R=(t,e)=>h(t,e,"dist/sendKeypressTeams.js"),p=(t,e,o,s)=>{chrome.tabs.query({url:t},r=>{e==1&&chrome.scripting.executeScript({target:{tabId:Number(r[o].id)},func:s},y)})},x=(t,e,o)=>p(t,e,o,S),U=(t,e,o)=>p(t,e,o,N),S=()=>{var o;let t=!1,e=!0;for(let s of document.getElementsByTagName("*"))if(s.innerHTML.indexOf("Join now")!=-1||s.innerHTML.indexOf("Rejoin")!=-1)e=!1;else if(s.matches('[aria-label~="microphone"]')&&["DIV","BUTTON"].includes(s.nodeName)){const r=(o=s.dataset)==null?void 0:o.isMuted;if(r===void 0)continue;t=JSON.parse(r)}return[t,e]},N=()=>{let t=!1,e=!0;return t=document.getElementById("microphone-button").dataset.state=="mic-off",[t,e]},m=(t,e,o="Meeting Service")=>{const s={isOpen:!1,tabId:-1,count:0,alerts:!1,onlyTab:!1};return t.forEach((r,d)=>{r.url==e?s.isOpen=!0:s.count++}),s.count>0&&chrome.alarms.create("1min",{periodInMinutes:.05}),s.count===0&&(chrome.alarms.clear("1min"),chrome.action.setIcon({path:i}),chrome.action.setBadgeText({text:""})),s.count===1&&(s.alerts=!1,chrome.action.setBadgeText({text:""})),t.forEach((r,d)=>{s.alerts||(s.count>1?(chrome.notifications.create("",{type:"basic",title:"",message:`You have ${s.count} ${o} open. Close all but one.`,iconUrl:i}),s.alerts=!0,chrome.action.setBadgeText({text:"Err"})):s.tabId=d)}),s},u=t=>{if(O(),E(),!(c.count+n.count+a.count<=0)){if(c.count>0&&n.count+a.count<=0){t&&L(c.tabId),setTimeout(()=>x(l,c.count,c.tabId),50);return}if(c.count<=0&&n.count+a.count>0&&(n.count<=0||a.count<=0)){const e=n.count>0?n:a,o=n.count>0?f:b;t&&R(e.tabId,o),setTimeout(()=>U(o,e.count,e.tabId),50);return}chrome.notifications.create("",{type:"basic",title:"",message:`You have ${c.count+n.count+a.count} Meet & Teams open. Close all but one.`,iconUrl:i})}};chrome.action.onClicked.addListener(t=>{u(!0)});chrome.tabs.onUpdated.addListener((t,e,o)=>{(e.status=="complete"||e.discarded)&&u(!1)});chrome.alarms.onAlarm.addListener(t=>{t.name==="1min"&&u(!1)});u(!1);addEventListener("beforeunload",()=>{chrome.action.setIcon({path:i}),chrome.action.setBadgeText({text:""})});chrome.commands.onCommand.addListener(t=>{t==="toggle-mute"&&u(!0)});
